<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="viewport" content="width=device-width">
<link rel="stylesheet" href="/past/2020/spring/edh7916/assets/css/style.css">
<link rel="stylesheet" href="/past/2020/spring/edh7916/assets/css/syntax_default.css">
<link rel="shortcut icon" type="image/png" href="/past/2020/spring/edh7916/assets/img/favicon.ico">
<link crossorigin="anonymous" media="all" integrity="sha512-uhAd27cNiLn0VE2GVEVUN8D5zW0o7s0QTnCGMnJZkL2HqN9/LwHDi4ndTPJH0upUQHYl/8QF6cwbOYp/KIzlJQ==" rel="stylesheet" href="https://github.githubassets.com/assets/github-be4e45349cf088df7a6636f437c0a167.css" />
<script defer src="/past/2020/spring/edh7916/assets/js/all.min.js"></script>
<!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<script async defer src="https://buttons.github.io/buttons.js"></script>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

<title>edquant | EDH 7916: Contemporary Research in Higher Education</title>

  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>EDH 7916: Contemporary Research in Higher Education<a href="https://github.com/edquant/past" class="iconlink">
	      <i class="fab fa-github fa-sm"></i></a></h1>
	<h2 class="thin">Spring 2020</h2>
	<p>A course in quantitative research workflow for students in
the higher education administration program at the University of Florida
</p>
	<!-- side / top bar menu -->
	<h2 class="thin">
	  <a href="/past/2020/spring/edh7916/">Overview</a></br>
	  <a href="/past/2020/spring/edh7916/syllabus/">Course
	    information</a></br>
	  <a href="/past/2020/spring/edh7916/location/">Meeting
	    location</a></br>
	  <a href="/past/2020/spring/edh7916/start/">Getting started</a></br>
	  <a href="/past/2020/spring/edh7916/schedule/">Schedule</a></br>
	  <a href="/past/2020/spring/edh7916/lessons/">Lessons</a></br>
	  <a href="/past/2020/spring/edh7916/assignments/">Assignments</a></br>
	  <a href="/past/2020/spring/edh7916/questions/">Questions</a></br>
	  <a href="/past/2020/spring/edh7916/about/">About</a></br>	  
	</h2>
      </header>

      <section>
	<h1>Data Wrangling IV: A philosophy of data wrangling</h1>
	

	
<p>
  
  <a href="/past/2020/spring/edh7916/assets/pdf/dw_four.pdf"
     class="iconlink" download title="Get PDF of lesson">
  <i class="far fa-file-pdf fa-2x"></i>
  </a>
  
  &nbsp;&nbsp;
  
  
  
  
</p>


<p>Now that we’ve learned a variety of data wrangling tasks, we’ll take
some time to discuss good workflow, that is, moving from raw data to
data that are ready for analysis. In the lessons and assignments we’ve
had so far, we’ve actually already covered many of the major points that
are discussed below. This lesson, therefore, mostly just makes explicit
the good practices that we’ve implicitly followed.</p>

<h1 id="organization">Organization</h1>

<p>From the <a href="https://edquant.github.io/edh7916/lessons/organizing.html">second
lesson</a>,
we’ve been very concerned about how our project is organized. This
includes both the directory of folders and files on our machine and the
scripts that run our analyses.</p>

<h2 id="project-directory">Project directory</h2>

<p>While it is certainly <em>easier</em> on the front end to store all project
files in a single folder</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./project
|
|--+ analysis.R
|--+ clean.R
|--+ clean_data.rds
|--+ data1.csv
|--+ data2.csv
|--+ histogram_x.png
|--+ density_z.png
</code></pre></div></div>

<p>it’s better to separate files by type/purpose in your project directory
(“a place for everything and everything in its place”):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./project
|
|__/data
|   |--+ clean_data.rds
|   |--+ data1.csv
|   |--+ data2.csv
|__/figures
|   |--+ histogram_x.png
|   |--+ density_z.png
|__/scripts 
    |--+ analysis.R
    |--+ clean.R
</code></pre></div></div>

<p>Just like there’s something to be said for visiting the library in order
to scan titles in a particular section — it’s easier to get an idea of
what’s available by looking at the shelf than by scanning computer
search output — it’s useful to be able to quickly scan only the relevant
files in a project. With well-named files (discussed below) and an
organized directory structure, a replicator may be able to guess the
purpose, flow, and output of your project without even running your
code.</p>

<blockquote>
  <h4 id="quick-question">Quick question</h4>

  <p>When using a project directory instead of just a single folder, we
need to use file paths. In particular, we use <em>relative paths</em> rather
than <em>fixed paths</em>. Why?</p>
</blockquote>

<h2 id="script">Script</h2>

<p>In the <a href="https://edquant.github.io/edh7916/lessons/organizing.html">second lesson on
organizing</a>,
I also shared a template R script. While you do not need to use my
particular template — in fact, you should modify it to meet your needs —
it does follow a few organizational rules that you should follow as
well.</p>

<ol>
  <li>Clear header with information about the project, this file, and you.</li>
  <li>Load libraries, set paths and macros, and write functions towards
the top of the file.</li>
  <li>Clear sections for reading in data, process, and output
(ingredients, recipe, prepared dish).</li>
</ol>

<blockquote>
  <h4 id="quick-question-1">Quick question</h4>

  <p>Why put things like file paths or macros at the top of the file?</p>
</blockquote>

<h1 id="clarity">Clarity</h1>

<p>Remember: even though our scripts are instructions for the computer,
they are also meant to be read by us humans. How well you comment your
code and how well you name your objects, scripts, data, output, <em>etc</em>,
determine the clarity of your intent.</p>

<h2 id="commenting">Commenting</h2>

<p>Don’t assume that your intent is clear. Particularly because so much
working code comes as the result of many (…many…many…) revisions to
non-working code, it’s very important that you comment liberally.</p>

<ul>
  <li>
    <p>What are you doing?</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Creating a dummy variable for each state from current categorical variable</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>
    <p>Why are you doing it this way?</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Converting 1/2 indicator to 0/1 for clarity</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>
    <p>Links to supporting documents/websites</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## see &lt;url&gt; for data codebook</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>
    <p>Hat-tip (h/t) for borrowed code</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## h/t &lt;url&gt; for general code that I slightly modified </span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>
    <p>Formula / logic behind method</p>

    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## log(xy) = log(x) + log(y)</span><span class="w">
</span><span class="c1">## using logarithms for more numerically stable calculations </span><span class="w">
</span></code></pre></div>    </div>
  </li>
</ul>

<p>All of these items are good uses for comments.</p>

<blockquote>
  <h4 id="quick-question-2">Quick question</h4>

  <p>In which situation are comments not useful?</p>
</blockquote>

<h2 id="naming">Naming</h2>

<p>For R, all the following objects are functionally equivalent:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## v.1</span><span class="w">
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Alabama"</span><span class="p">,</span><span class="s2">"Alaska"</span><span class="p">,</span><span class="s2">"Arkansas"</span><span class="p">)</span><span class="w">

</span><span class="c1">## v.2</span><span class="w">
</span><span class="n">stuff</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Alabama"</span><span class="p">,</span><span class="s2">"Alaska"</span><span class="p">,</span><span class="s2">"Arkansas"</span><span class="p">)</span><span class="w">

</span><span class="c1">## v.3</span><span class="w">
</span><span class="n">cities</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Alabama"</span><span class="p">,</span><span class="s2">"Alaska"</span><span class="p">,</span><span class="s2">"Arkansas"</span><span class="p">)</span><span class="w">

</span><span class="c1">## v.4</span><span class="w">
</span><span class="n">states</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Alabama"</span><span class="p">,</span><span class="s2">"Alaska"</span><span class="p">,</span><span class="s2">"Arkansas"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>However, only the last object, <code class="language-plaintext highlighter-rouge">states</code>, makes logical sense to us based
on its contents. So while R will work just as happily with <code class="language-plaintext highlighter-rouge">x</code>, <code class="language-plaintext highlighter-rouge">stuff</code>,
<code class="language-plaintext highlighter-rouge">cities</code>, or <code class="language-plaintext highlighter-rouge">states</code>, a collaborator will appreciate <code class="language-plaintext highlighter-rouge">states</code> since it
gives an idea of what it contains (or should contain) — even without
running the code.</p>

<blockquote>
  <h4 id="quick-question-3">Quick question</h4>

  <p>Without seeing the initial object assignment, what might you expect to
see as output from the following code coming from a fellow higher
education researcher? Why?</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">flagship_names</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>  </div>
</blockquote>

<p>When objects are well named, your code may become largely
<a href="https://en.wikipedia.org/wiki/Self-documenting_code">self-documenting</a>,
which is particularly nice since you don’t have to worry about drift
between your comments and code over time.</p>

<h1 id="automation">Automation</h1>

<p>In the <a href="https://edquant.github.io/edh7916/lessons/programming.html">functional programming
lesson</a>, we
discussed the difference between <strong>D</strong>on’t <strong>R</strong>epeat <strong>Y</strong>ourself
programming and <strong>W</strong>rite <strong>E</strong>very <strong>T</strong>ime programming. As much as
possible and within the dictates of organizing and clarity, it’s a good
idea to automate as much as you can.</p>

<h2 id="push-button-replication">Push-button replication</h2>

<p>If I’ve said it once, I’ve said it 1,000 times: I want an analysis
script — in particular, a replication script — to run by <em>just pushing a
button</em>. What I mean by this is that I want to:</p>

<ol>
  <li>Download the project directory</li>
  <li>Open the script in R Studio</li>
  <li>(If necessary, make sure I’m in the correct working directory)</li>
  <li>Push the “Run” button and have all the analyses run with all
estimates/figures/tables being produced and sent to their proper
project folders.</li>
</ol>

<p>The dream!</p>

<p>When projects are complicated or data isn’t easily shared (or can’t be
shared), the push button replication may not be feasible. But your goal
should always be to get as close to that as possible. Make your life a
little harder so your collaborators, replicators — and future you! —
have it a little easier.</p>

<p><strong>ONE NOTE</strong> Like writing a paper, the process going from a blank script
to a final product typically isn’t linear. You’ll have starts and stops,
dead-ends and rewrites. You shouldn’t expect a polished paper from the
first draft, and you shouldn’t expect to code up a fully replicable
script from the get-go.</p>

<p>There’s something to be said for just getting your ideas down on paper,
no matter how messy. Similarly, it may be better to <em>just get your code
to work first</em> and then clean it up later. My only warning here is that
while you have to clean up a paper eventually (someone’s going to read
it), code still remains largely hidden from public view. There will be a
temptation to get it to work and then move on. Fight that urge!</p>

<blockquote>
  <h4 id="quick-question-4">Quick question</h4>

  <p>In a world in which not everyone knows how to use R, what’s another
benefit of push-button automation?</p>
</blockquote>

<h2 id="multiple-scripts">Multiple scripts</h2>

<p>We’ve only worked with one script so far, but you can use the <code class="language-plaintext highlighter-rouge">source()</code>
function in R to call other R scripts. For a very large project, you may
decide to have multiple scripts. For example, you may have one script
that downloads data, one that cleans the data, one that performs the
analyses, and one that makes the figures.</p>

<p>Rather than telling a would-be replicator to “run the following files in
the following order”</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">get_data.R</code></li>
  <li><code class="language-plaintext highlighter-rouge">clean_data.R</code></li>
  <li><code class="language-plaintext highlighter-rouge">do_analysis.R</code></li>
  <li><code class="language-plaintext highlighter-rouge">make_figures.R</code></li>
</ol>

<p>you could instead include a <code class="language-plaintext highlighter-rouge">run_all.R</code> script that only sources each
script in order and tell the replicator to run that:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## download data</span><span class="w">
</span><span class="n">source</span><span class="p">(</span><span class="s2">"./get_data.R"</span><span class="p">)</span><span class="w">

</span><span class="c1">## clean data</span><span class="w">
</span><span class="n">source</span><span class="p">(</span><span class="s2">"./clean_data.R"</span><span class="p">)</span><span class="w">

</span><span class="c1">## run analyses</span><span class="w">
</span><span class="n">source</span><span class="p">(</span><span class="s2">"./do_analysis.R"</span><span class="p">)</span><span class="w">

</span><span class="c1">## make figures</span><span class="w">
</span><span class="n">source</span><span class="p">(</span><span class="s2">"./make_figures.R"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Not only is that easier for others to run, you now have a single script
that makes your analytic workflow much clearer. Note that there are
other ways to do something like this, such as using
<a href="https://en.wikipedia.org/wiki/Makefile">makefiles</a> (<a href="https://github.com/btskinner/oa_online_broadband_rep">here’s an example
for one of my
projects</a>), but
using only R will work pretty well.</p>

<h1 id="testing">Testing</h1>

<p>As you wrangle your data, you should take advantage of your computer’s
power not only to perform the munging tasks you require, but also to
test that inputs and outputs are as expected.</p>

<h2 id="expected-data-values">Expected data values</h2>

<p>Let’s say you are investigating how college students use their time. You
have data from a time use study in which 3,000 students recorded how
they spent every hour for a week. The data come to you at the
student-week level and grouped by activity type. This means you see that
Student A spent 15 hours working, 20 hours studying/doing homework,
<em>etc</em>. You create a new column that adds the time for all categories
together and take the summary. You find:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">variable</th>
      <th style="text-align: center">mean</th>
      <th style="text-align: center">sd</th>
      <th style="text-align: center">min</th>
      <th style="text-align: center">max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">total_hrs</td>
      <td style="text-align: center">167.99</td>
      <td style="text-align: center">1.93</td>
      <td style="text-align: center">152.48</td>
      <td style="text-align: center">183.46</td>
    </tr>
  </tbody>
</table>

<p>Something is wrong.</p>

<blockquote>
  <h4 id="quick-question-5">Quick question</h4>

  <p>What’s wrong?</p>
</blockquote>

<p>Rather than going through an ad-hoc set of “ocular” checks, you can
build in more formal checks. We’ve done a little of this when using
<code class="language-plaintext highlighter-rouge">identical()</code> or <code class="language-plaintext highlighter-rouge">all.equal()</code> to compare data frames. You could build
these into your scripts. For example:</p>

<ul>
  <li>reading in data with student GPAs, check if they are negative</li>
  <li>combining data from 100 students at 5 schools, make sure your final
data frame has 500 rows</li>
  <li>creating a new percentage from two values, check that the value
between 0 and 100 (or between 0 and 1 if a proportion)</li>
</ul>

<p>You can use simple tests to check, and include a <code class="language-plaintext highlighter-rouge">stop()</code> command inside
an <code class="language-plaintext highlighter-rouge">if()</code> statement:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## halt if max number of months is greater than 12 since data are only</span><span class="w">
</span><span class="c1">## for one year</span><span class="w">
</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">months</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">12</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">stop</span><span class="p">(</span><span class="s2">"Reported months greater than 12! Check!"</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>This only works if you know your data. Knowing your data requires both
domain knowledge (“Why are summer enrollments so much higher than fall
enrollments…that doesn’t make sense.”) and particular knowledge about
your data (“All values of <em>x</em> between 50 and 100, except these two,
which are -1 and 20000…something’s up”).</p>

<h2 id="expected-output-from-functions">Expected output from functions</h2>

<p>Programmers are big on <a href="https://en.wikipedia.org/wiki/Unit_testing">unit
testing</a> their functions.
This simply means giving their functions or applications very simple
input that <em>should</em> correspond to straightforward output and confirming
that that is the case.</p>

<p>For example, if their function could have three types of output
depending on the input, they run at least three tests, one for each type
of output they expect to see. In practice, they might run many more
tests for all kinds of conditions — even those that should “break” the
code to make sure the proper errors or warnings are returned.</p>

<p>As data analysts, you are unlikely to need to conduct a full testing
regime for each project. But if you write your own functions, you should
definitely stress test them a bit. This testing shouldn’t be in your
primary script but rather in another script, perhaps called <code class="language-plaintext highlighter-rouge">tests.R</code>.
These can be informal tests such as</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## should return TRUE</span><span class="w">
</span><span class="p">(</span><span class="n">function_to_return_1</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>or more sophisticated tests using R’s
<a href="https://testthat.r-lib.org">{testthat}</a> library.</p>

<p>Again, the point isn’t that you spend all your time writing unit tests.
But spending just a bit of time checking that your functions do what you
think they do will go a long way.</p>

<blockquote>
  <h4 id="quick-question-6">Quick question</h4>
</blockquote>

<blockquote>
  <p>Imagine you’ve written your own version of <code class="language-plaintext highlighter-rouge">scale()</code>, which lets you
normalize a set of numbers to N(0,1):</p>

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">my_scale</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="c1">## get mean</span><span class="w">
    </span><span class="n">mean_x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
    </span><span class="c1">## set sd</span><span class="w">
    </span><span class="n">sd_x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
    </span><span class="c1">## return scaled values</span><span class="w">
    </span><span class="c1">##             x - mean_x</span><span class="w">
    </span><span class="c1">## scaled_x = ------------</span><span class="w">
    </span><span class="c1">##                sd_x</span><span class="w">
    </span><span class="nf">return</span><span class="p">((</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mean_x</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">sd_x</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>  </div>

  <p>What kind of tests do you think you should run, <em>i.e.</em>, what kind of
inputs should you give it and what should you expect?</p>
</blockquote>

<h2 id="fail-loudly-and-awkwardly">Fail loudly and awkwardly</h2>

<p>There is a notion in software development that a program should <a href="https://en.wikipedia.org/wiki/Graceful_exit">fail
gracefully</a>, which means
that when a problem occurs, the program should at the very least give
the user a helpful error message rather than just stopping without note
or looping forever until the machine <a href="https://en.wikipedia.org/wiki/Halt_and_Catch_Fire">halts and catches
fire</a>.</p>

<p>As data analysts, I want your scripts to do the opposite: I want your
code to exit loudly and awkwardly if there’s a problem. You aren’t
writing a program but rather an analysis. Therefore, the
<a href="https://en.wikipedia.org/wiki/User_experience">UX</a> I care about is the
reader of your final results and your future replicators. <a href="https://genomebiology.biomedcentral.com/articles/10.1186/s13059-016-1044-7">Rather than
moving forward silently when something strange
happens</a>
— which is lovely on the front end because everything keeps running but
deadly on the back end — your code should stop and yell at you when
something unexpected happens. It’s annoying, but that’s the point.</p>

<h1 id="four-stages-of-data-a-taxonomy">Four stages of data: a taxonomy</h1>

<p>In the lessons so far, we’ve generally read in raw data, done some
processing that we printed to the console, and then finished. This is
fine for our small lessons and assignments, but in your own work, you
will want to save your changes to the data along the way — that is, save
updated data files at discrete points in your data analysis. This is
particularly true for large projects in which wrangling your data is
distinct from its analysis and you don’t want to run each part every
time.</p>

<p>Broadly, there are four stages of data:</p>

<ol>
  <li>Raw data</li>
  <li>Built data (objective changes)</li>
  <li>Clean data (subjective changes)</li>
  <li>Analysis data</li>
</ol>

<p>For small projects, you may not end up with data files for each stage.
That said, your workflow should be organized in terms of moving from one
stage to the next.</p>

<p>We’ll talk about each below.</p>

<p><strong>ACKNOWLEDGMENT</strong> I want to give a quick hat tip to two people who’ve
really helped me clarify my thinking about these stages of data: <a href="https://twitter.com/wdoyle42">Will
Doyle</a> and <a href="https://twitter.com/SallyLHudson">Sally
Hudson</a>: Will for first showing the
importance of keeping raw data untouched; and Sally for showing how
useful it is to make a distinction between objective and subjective data
processing, particularly in large projects. Thanks and credit to both.</p>

<h2 id="raw-data">Raw data</h2>

<p>Raw data, that is, the data you scrape, download, receive from an
advisor or research partner, <em>etc</em>, are sacrosanct. Do not change them!
They are to be read into R (or whatever software you use) and that is
all.</p>

<p>You will be tempted from time to time to <em>just fix this one thing</em> that
is wonky about the data. Maybe you have a <code class="language-plaintext highlighter-rouge">*.csv</code> file that has a bunch
of junk notes written above the actual data table (not uncommon). The
temptation will be to delete those rows so you have a clean file. NO!
There are ways to skip rows in a file like this, for example. R is
particularly good at reading in a large number of data types with a
large number of special situations.</p>

<p>If you are at all concerned that you or a collaborator may accidentally
save over your raw files, your operating system will allow you to change
the file permissions such that they are <strong>read-only files</strong> (Dropbox
will let you protect files in this way, too). Particularly if working
with a number of collaborators, protecting your raw data files in this
way is a good idea.</p>

<h2 id="built-data-objective-changes">Built data (objective changes)</h2>

<p>As a first step in processing your data, you should only make <em>objective
modifications</em>. What do I mean by objective? They are those
modifications that:</p>

<ol>
  <li>Are required to get your data in good working order</li>
  <li>Are modifications that will always be needed across projects using
the same data (in the context of multiple projects)</li>
</ol>

<p>To the first point, let’s say you receive student-level administrative
data that includes a column, <code class="language-plaintext highlighter-rouge">state</code>, that is the student’s home state.
However, values in the column include:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">"Kentucky"</code></li>
  <li><code class="language-plaintext highlighter-rouge">"KY"</code></li>
  <li><code class="language-plaintext highlighter-rouge">"Ken"</code></li>
  <li><code class="language-plaintext highlighter-rouge">"21"</code> (state FIPS code)</li>
</ul>

<p>Another example would be a date column, <code class="language-plaintext highlighter-rouge">month</code>, in which you see:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">"February"</code></li>
  <li><code class="language-plaintext highlighter-rouge">"Feb"</code></li>
  <li><code class="language-plaintext highlighter-rouge">"2"</code></li>
</ul>

<p>In both cases, it’s clear that you want a consistent format for the
data. Whatever you pick, these are objective changes that you would make
at this time.</p>

<p>To the second point, let’s say this same administrative data are going
to be used across multiple projects. In each project, you need to
compute the proportion of in-state vs. out-of-state students. The data
column that indicates this is called <code class="language-plaintext highlighter-rouge">residency</code> and is coded (with no
data labels) as</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">1</code> := in-state</li>
  <li><code class="language-plaintext highlighter-rouge">2</code> := out-of-state</li>
</ul>

<p>Coming back to the data later and taking a look at the first few rows in
<code class="language-plaintext highlighter-rouge">residency</code>, will it be clear</p>

<ul>
  <li>what <code class="language-plaintext highlighter-rouge">residency</code> means?</li>
  <li>what the values of <code class="language-plaintext highlighter-rouge">1</code> and <code class="language-plaintext highlighter-rouge">2</code> represent?</li>
</ul>

<p>No.</p>

<p>An objective change that you can use across analyses will be to make a
new column called <code class="language-plaintext highlighter-rouge">instate</code> in which</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">0</code> := out-of-state</li>
  <li><code class="language-plaintext highlighter-rouge">1</code> := in-state</li>
</ul>

<p>The benefits are three-fold:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">0</code> and <code class="language-plaintext highlighter-rouge">1</code> are logically coded as <code class="language-plaintext highlighter-rouge">FALSE</code> and <code class="language-plaintext highlighter-rouge">TRUE</code></li>
  <li><code class="language-plaintext highlighter-rouge">instate</code> gives a direction to the <code class="language-plaintext highlighter-rouge">0</code>s and <code class="language-plaintext highlighter-rouge">1</code>s: <code class="language-plaintext highlighter-rouge">1</code> means in-state</li>
  <li>taking the mean of <code class="language-plaintext highlighter-rouge">instate</code> will give you the proportion</li>
</ul>

<p>If your data or project (or number of projects) is large, you many want
to save data files after your objective wrangling. These can be reused
across projects, which will make sure that objective data wrangling
decisions are consistent.</p>

<h2 id="clean-data-subjective-changes">Clean data (subjective changes)</h2>

<p>Whatever changes are left over after you’ve make objective changes are
<em>subjective</em> changes. These changes are project and analysis specific.</p>

<p>For example, let’s say your student-level administrative data have
information about the student’s <a href="https://fafsa.ed.gov/help/fftoc01g.htm">expected family contribution or
EFC</a>. In your data, you have the
actual values. However, you want to compare your data to other published
research in which EFC is binned into discrete categories. This means
that in order to make a comparison, you have to bin your data the same
way. This is a subjective task for two reasons:</p>

<ul>
  <li>there’s not an <em>objective</em> reason to bin your data in this manner,
<em>i.e.</em> to make the data consistent or clearer</li>
  <li>it’s unlikely you’ll need this new column of data for other projects</li>
</ul>

<p>But wait! Maybe you <em>do</em> want to use this new binned value of EFC in
multiple projects. And maybe the binned categories are standard across
the literature. Isn’t that <em>objective</em>?</p>

<p>Maybe!</p>

<p>The thing about determining the difference between <em>objective</em> vs
<em>subjective</em> cleaning is that on the margins, well, it’s subjective!
The point is not to have hard and fast rules, but rather to do your best
to clearly separate those data wrangling tasks that must be done for the
sake of consistency and clarity versus those that may change depending
on your research question(s).</p>

<blockquote>
  <h4 id="quick-question-7">Quick question</h4>

  <p>What might be some other <em>subjective</em> data wrangling tasks? Think
about other research you’ve conducted or seen. Or think about what our
lessons and assignments so far: what have been subjective tasks?</p>
</blockquote>

<h2 id="analysis-data">Analysis data</h2>

<p>Finally, analysis data are data that are properly structured for the
analysis you want to run (or the table or figure you want to make). In
many cases, you’re analysis data set will be the same as your clean data
set:</p>

<ul>
  <li>it’s in the shape you want (rectangular, with observations in rows
and variables in columns)</li>
  <li>it has all the variables you need to compute summary statistics or
run regression models</li>
</ul>

<p>Most R statistical routines (<em>e.g.</em>, <code class="language-plaintext highlighter-rouge">mean()</code>, <code class="language-plaintext highlighter-rouge">sd()</code>, <code class="language-plaintext highlighter-rouge">lm()</code>) do a fair
amount of data wrangling under the hood to make sure it can do what you
ask. For example, you may have missing values (<code class="language-plaintext highlighter-rouge">NA</code>) in your clean data
set, but R’s linear model function, <code class="language-plaintext highlighter-rouge">lm()</code>, will just drop observations
with missing values by default. If you are okay with that in your
analysis, R can handle it.</p>

<p>However, for some special models or figures, you may need to reshape or
pre-process your clean data in one last step before running the specific
analysis you want. For example, your clean data frame may have a column
of parental occupational field (<code class="language-plaintext highlighter-rouge">parocc</code>) as a categorical variable in
which the first few categories are</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">11</code> := Management Occupations</li>
  <li><code class="language-plaintext highlighter-rouge">13</code> := Business and Financial Operations Occupations</li>
  <li><code class="language-plaintext highlighter-rouge">15</code> := Computer and Mathematical Occupations</li>
  <li><code class="language-plaintext highlighter-rouge">17</code> := Architecture and Engineering Occupations</li>
</ul>

<p>…and so on. You want to run an analysis in which you can’t use this
categorical variable but instead need a vector of dummy variables, that
is, converting this single column into a bunch of columns that only take
on <code class="language-plaintext highlighter-rouge">0</code>/<code class="language-plaintext highlighter-rouge">1</code> values if <code class="language-plaintext highlighter-rouge">parocc</code> equals that occupation:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">manage_occ == 1</code> if <code class="language-plaintext highlighter-rouge">parocc == 11</code> else <code class="language-plaintext highlighter-rouge">manage_occ == 0</code></li>
  <li><code class="language-plaintext highlighter-rouge">busfin_occ == 1</code> if <code class="language-plaintext highlighter-rouge">parocc == 13</code> else <code class="language-plaintext highlighter-rouge">busfin_occ == 0</code></li>
  <li><code class="language-plaintext highlighter-rouge">commat_occ == 1</code> if <code class="language-plaintext highlighter-rouge">parocc == 15</code> else <code class="language-plaintext highlighter-rouge">commat_occ == 0</code></li>
  <li><code class="language-plaintext highlighter-rouge">arceng_occ == 1</code> if <code class="language-plaintext highlighter-rouge">parocc == 17</code> else <code class="language-plaintext highlighter-rouge">arceng_occ == 0</code></li>
</ul>

<p>…and so on. Particularly if</p>

<ul>
  <li>your data are large</li>
  <li>the analysis takes a while to run</li>
  <li>you want to use the same data set up for multiple (but not all)
models or analytic tasks</li>
</ul>

<p>you may want to save this particular analysis data set.</p>

<p>As with the difference between <em>objective</em> and <em>subjective</em> data, the
difference between <em>subjective</em> and <em>analysis</em> data may not be clear.
That’s okay! The main point is that as a data analyst, you make data
wrangling decisions thinking about how you will go from <em>raw</em> to
<em>objective</em> to <em>subjective</em> to <em>analysis</em> data in a logical and clear
manner. Collaborators, replicators, and future you will appreciate it!</p>

<h1 id="recommended-texts">Recommended texts</h1>

<p>There are a number of great texts that talk about the process of data
wrangling. Two that have particularly informed this lecture and are
worth looking at more fully:</p>

<ul>
  <li><a href="https://pragprog.com/book/tpp20/the-pragmatic-programmer-20th-anniversary-edition">The Pragmatic Programmer: From Journeyman to
Master</a>
by Andrew Hunt and David Thomas</li>
  <li><a href="https://web.stanford.edu/~gentzkow/research/CodeAndData.pdf">Code and Data for the Social Sciences: A Practitioner’s
Guide</a>
by Matthew Gentzkow and Jesse Shapiro</li>
</ul>



	<!-- <p> -->
	<!--   Updated:  -->
	<!-- </p> -->
      </section>
      <footer>
        <p>
  Benjamin Skinner</br>  
  Assistant Professor</br>  
  University of Florida</br>
  <a href="https://www.btskinner.io" class="iconlink" alt="Personal website">
    <i class="fas fa-home fa-lg"></i></a> | 
  <a href="https://github.com/btskinner" class="iconlink" alt="Github
								profile">
    <i class="fab fa-github fa-lg"></i></a> |
  <a href="https://twitter.com/btskinner" class="iconlink" alt="Twitter profile">
    <i class="fab fa-twitter fa-lg"></i></a>
</p>
<p>
  <small>
    <a href="https://pages.github.com">GitHub Pages</a> |
    <a href="https://github.com/orderedlist/minimal">Theme</a> |
    <a href="/past/2020/spring/edh7916/releases/">Releases</a>
  </small>
</p>

      </footer>
    </div>

    <!-- load Javascript if page requires it -->
    
    
    

    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-63981025-1', 'auto');
        ga('send', 'pageview');
    </script>
  
  </body>
</html>
